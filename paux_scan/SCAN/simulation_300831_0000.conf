# ======================================================================
# SIMULATION INFO SECTION
# ======================================================================

RUN_ID = fastran
TOKAMAK_ID = FPP
# SHOT_NUMBER = 
# TIME_ID = 

SIM_NAME = fastran_FPP_000001_300831_0000

OUTPUT_PREFIX = ""
LOG_FILE = run.log_300831_0000
LOG_LEVEL = DEBUG

INPUT_DIR_SIM = ${PWD}/input
SIM_ROOT = /pscratch/sd/h/hswils/github_repos/MANTA_DBSCANS/paux_scan/SCAN/simulation_300831_0000

RUN_COMMENT = Template
TAG = ""

SIMULATION_MODE = NORMAL
RESTART_TIME = ""
RESTART_ROOT = ${SIM_ROOT}

USE_PORTAL = True
PORTAL_URL = http://lb.ipsportal.production.svc.spin.nersc.org

# ======================================================================
# PLASMA STATE SECTION
# ======================================================================

STATE_WORK_DIR = ${SIM_ROOT}/work/plasma_state

CURRENT_STATE = s${SHOT_NUMBER}.${TIME_ID}
CURRENT_EQDSK = g${SHOT_NUMBER}.${TIME_ID}
CURRENT_INSTATE = i${SHOT_NUMBER}.${TIME_ID}

STATE_FILES = ${CURRENT_STATE} ${CURRENT_EQDSK} ${CURRENT_INSTATE}
OUT_REDIRECT = TRUE
PARENT_PORTAL_RUNID = fastran_FPP_000001_perlmutter_hswils_2025-07-29T17:44:06.768
OUT_REDIRECT_FNAME = /pscratch/sd/h/hswils/github_repos/MANTA_DBSCANS/paux_scan/SCAN/fastran_FPP_000001_300831_0000.out

# ======================================================================
# PORTS SECTION
# ======================================================================

[PORTS]
    
    NAMES = INIT DRIVER EQ0 TR0 IC EQ TR
    PREPROCESS = EQ0 TR0
    POSTPROCESS = ""
    
    # DRIVER and INIT   
    
    [[DRIVER]]
        IMPLEMENTATION = fastran_driver
    
    [[INIT]]
        IMPLEMENTATION = fastran_init
    
    # Physics ports
    
    [[TR0]]
        IMPLEMENTATION = fastran0
    
    [[TR]]
        IMPLEMENTATION = fastran
    
    [[EQ0]]
        IMPLEMENTATION = efit0
    #       IMPLEMENTATION = freegs0
    
    [[EQ]]
        IMPLEMENTATION = efit
    
    [[EC]]
        IMPLEMENTATION = toray
    
    [[HC]]
        IMPLEMENTATION = genray_hc
    
    [[LH]]
        IMPLEMENTATION = genray_lh
    
    [[IC]]
        #       IMPLEMENTATION = hcd_model
        IMPLEMENTATION = toric
    
    [[NB]]
        IMPLEMENTATION = nfreya
    #       IMPLEMENTATION = nubeam  
    
    [[HCD0]]
        IMPLEMENTATION = hcd_model
    
    [[BC0]]
        IMPLEMENTATION = modeleq_constraint
    #       IMPLEMENTATION = constraint_current0
    
    [[BC]]
        IMPLEMENTATION = constraint_current
    
    [[POST]]
        IMPLEMENTATION = fastran1
    
    # Monitor ports
    
    [[MONITOR]]
        IMPLEMENTATION = monitor

# ======================================================================
# COMPONENT CONFIGURATION SECTION
# ======================================================================

[fastran_init]
    CLASS = fastran
    SUB_CLASS = init
    NAME = fastran_init
    MODULE = fastran.driver.fastran_init
    SCRIPT = ""
    NPROC = 1
    BIN_PATH = ""
    BIN = ""
    INPUT_DIR = ${INPUT_DIR_SIM}
    INIT_METHOD = instate
    INSTATE_METHOD = model
    INSTATE = instate
    #   INGEQDSK = ingeqdsk
    INPUT_FILES = ${INSTATE}    #${INGEQDSK}
    OUTPUT_FILES = ""
    RESTART_FILES = ""
    R0 = 4.550000000000000e+00
    A0 = 1.200000000000000e+00
    KAPPA = 1.400000000000000e+00
    DELTA = -5.000000000000000e-01
    B0 = 1.100000000000000e+01
    IP = 1.000000000000000e+01
    XWID = 5.000000000000000e-02
    XMID = 9.750000000000000e-01
    NE_AXIS = 2.760000000000000e+01
    NE_PED = 1.442400000000000e+01
    NE_SEP = 9.000000000000000e+00
    TE_AXIS = 1.880000000000000e+01
    TE_PED = 3.745500000000000e+00
    TI_AXIS = 1.900000000000000e+01
    TI_PED = 3.745500000000000e+00
    H98_TARGET = 8.000000000000000e-01

[fastran_driver]
    CLASS = fastran
    SUB_CLASS = driver
    NAME = fastran_driver
    MODULE = fastran.driver.fastran_driver
    SCRIPT = ""
    NPROC = 1
    BIN_PATH = ""
    BIN = ""
    INPUT_DIR = ${INPUT_DIR_SIM}
    INPUT_FILES = ""
    OUTPUT_FILES = ""
    RESTART_FILES = ""
    SUMMARY = ${PWD}/summary

[fastran0]
    CLASS = fastran
    SUB_CLASS = tr0
    NAME = fastran
    MODULE = fastran.solver.fastran
    SCRIPT = ""
    NPROC = 1
    NPROC_KY = 1
    BIN_PATH = ${FASTRAN_BIN_DIR}
    BIN = ${FASTRAN_SERIAL_BIN_NAME}
    INPUT_DIR = ${INPUT_DIR_SIM}
    INFASTRAN = infastran0
    INPUT_FILES = ${INFASTRAN} intglf
    OUTPUT_FILES = fastran.nc inprof inmetric infastran intglf xfastran.log ${CURRENT_INSTATE}
    RESTART_FILES = ""
    
    RELAX = 1.0
#   USE_INSTATE = YES
#   PS_BACKEND = instate

[fastran]
    CLASS = fastran
    SUB_CLASS = tr
    NAME = fastran
    SCRIPT = ""
    MODULE = fastran.solver.fastran
    NPROC = 1    # 32
    NPROC_KY = 1    # 8
    BIN_PATH = ${FASTRAN_BIN_DIR}
    #   BIN = ${FASTRAN_BIN_NAME}
    BIN = ${FASTRAN_SERIAL_BIN_NAME}
    INPUT_DIR = ${INPUT_DIR_SIM}
    INFASTRAN = infastran
    INPUT_FILES = ${INFASTRAN} intglf
    OUTPUT_FILES = fastran.nc inprof inmetric infastran intglf xfastran.log ${CURRENT_INSTATE}
    RESTART_FILES = ""
    
    RELAX = 0.25

[fastran1]
    CLASS = fastran
    SUB_CLASS = post
    NAME = fastran
    MODULE = fastran.solver.fastran
    SCRIPT = ""
    NPROC = 32
    NPROC_KY = 8
    BIN_PATH = ${FASTRAN_BIN_DIR}
    BIN = ${FASTRAN_BIN_NAME}
    INFASTRAN = infastran1
    INPUT_DIR = ${INPUT_DIR_SIM}
    INPUT_FILES = ${INFASTRAN} intglf
    OUTPUT_FILES = fastran.nc inprof inmetric infastran intglf xfastran.log ${CURRENT_INSTATE}
    RESTART_FILES = ""
    
    RELAX = 1.0

[efit0]
    CLASS = fastran
    SUB_CLASS = eq0
    NAME = efit
    MODULE = fastran.equilibrium.efit
    SCRIPT = ""
    NPROC = 1
    BIN_PATH = ${EFIT_BIN_DIR}
    BIN = ${EFIT_BIN_NAME} 129 129
    INPUT_DIR = ${INPUT_DIR_SIM}
    INPUT_FILES = ""
    OUTPUT_FILES = g*.* a*.* m*.* k*.* efit.log s*.*
    RESTART_FILES = ""
    
    INIT_RUN = 1
    INIT_RUN_STEP = 0
    NITER = 10
    #   PRESSURE = 'total'
    PRESSURE = kinetic
    
    TOPOLOGY = DN    # LSN USN DN
    SCALE = 1
    R0_SCALE = 1.7
    B0_SCALE = 2.0
    
    SERIAL = 1
#   PS_BACKEND = INSTATE

[efit]
    CLASS = fastran
    SUB_CLASS = eq
    NAME = efit
    MODULE = fastran.equilibrium.efit
    SCRIPT = ""
    NPROC = 1
    BIN_PATH = ${EFIT_BIN_DIR}
    BIN = ${EFIT_BIN_NAME} 129 129
    INPUT_DIR = ${INPUT_DIR_SIM}
    INPUT_FILES = ""
    OUTPUT_FILES = g*.* a*.* m*.* k*.* efit.log s*.*
    RESTART_FILES = ""
    
    INIT_RUN = 0
    INIT_RUN_STEP = 0
    NITER = 10
    #   PRESSURE = 'total'
    PRESSURE = kinetic
    
    TOPOLOGY = DN    # LSN USN DN
    SCALE = 1
    R0_SCALE = 1.7
    B0_SCALE = 2.0
    
    SERIAL = 1
    TIME_ID = 0.000000000000000e+00

[freegs0]
    CLASS = fastran
    SUB_CLASS = eq0
    NAME = freegs
    SCRIPT = ""
    MODULE = fastran.equilibrium.freegs
    NPROC = 1
    BIN_PATH = ""
    BIN = ""
    INPUT_DIR = ${INPUT_DIR_SIM}
    INCOIL = coils_MANTA_v0.json
    INPUT_FILES = ${INCOIL}
    OUTPUT_FILES = ${CURRENT_EQDSK}
    RESTART_FILES = ""
    INIT_RUN = 1
    NITER = 10
    
    #   PRESSURE = 'total'
    PRESSURE = kinetic
    TOPOLOGY = DN
    RMIN = 2.0
    RMAX = 7.0
    ZMIN = -4.0
    ZMAX = 4.0

#   PS_BACKEND = INSTATE

[nubeam]
    CLASS = fastran
    SUB_CLASS = nb
    NAME = nubeam
    MODULE = fastran.heating.nubeam
    SCRIPT = ""
    NPROC = 24
    BIN_PATH = ${NUBEAM_BIN_DIR}
    BIN = ${NUBEAM_BIN_NAME}
    PREACT = ${DATA_DIR}/nubeam/PREACT
    ADAS = ${DATA_DIR}/nubeam/ADAS
    INPUT_DIR = ${INPUT_DIR_SIM}
    INPUT_FILES = innubeam
    OUTPUT_FILES = log.nubeam* state_changes.cdf
    RESTART_FILES = *.cdf *.dat nubeam_comp_exec.RUNID
    COPY_PREACT = 0
    
    FREEZE = -1
    RESUME = -1

[toray]
    CLASS = fastran
    SUB_CLASS = ec
    NAME = toray
    MODULE = fastran.heating.toray
    SCRIPT = ""
    NPROC = 1
    BIN_PATH = ${TORAY_BIN_DIR}
    BIN = ${TORAY_BIN_NAME}
    INPUT_DIR = ${INPUT_DIR_SIM}
    INPUT_FILES = intoray
    OUTPUT_FILES = toray*.nc
    RESTART_FILES = ""

[genray_hc]
    CLASS = fastran
    SUB_CLASS = hc
    NAME = genray
    MODULE = fastran.heating.genray
    SCRIPT = ""
    NPROC = 1
    BIN_PATH = ${GENRAY_BIN_DIR}
    BIN = ${GENRAY_BIN_NAME}
    INPUT_DIR = ${INPUT_DIR_SIM}
    INGENRAY = ingenray_HC
    INPUT_FILES = ${INGENRAY}
    OUTPUT_FILES = genray.nc xgenray.log
    RESTART_FILES = ""
    
    UNIT = ""    #MKS
    ADD = 1
    IMODE = IC
    RHO_SMOOTH = 0.1
    
    SERIAL = 1

[genray_lh]
    CLASS = fastran
    SUB_CLASS = lh
    NAME = genray
    MODULE = fastran.heating.genray
    SCRIPT = ""
    NPROC = 1
    BIN_PATH = ${GENRAY_BIN_DIR}
    BIN = ${GENRAY_BIN_NAME}
    INPUT_DIR = ${INPUT_DIR_SIM}
    INGENRAY = ingenray_LH
    INPUT_FILES = ${INGENRAY}
    OUTPUT_FILES = genray.nc xgenray.log
    RESTART_FILES = ""
    
    UNIT = MKS
    ADD = 0
    IMODE = LH
    
    SERIAL = 1

[nfreya]
    CLASS = fastran
    SUB_CLASS = nb
    NAME = nfreya
    SCRIPT = ""
    MODULE = fastran.heating.nfreya
    NPROC = 1
    BIN_PATH = ${NFREYA_BIN_PATH}
    BIN = ${NFREYA_BIN_NAME}
    INPUT_DIR = ${INPUT_DIR_SIM}
    INPUT_FILES = innfreya
    OUTPUT_FILES = outone
    RESTART_FILES = ""
    DIR_DATA = ${NFREYA_DATA_ROOT}
    
    UPDATE_STATE = 1
#   PS_BACKEND = INSTATE

[hcd_model]
    CLASS = fastran
    SUB_CLASS = ic
    NAME = hcd_model
    MODULE = fastran.heating.hcd_model
    SCRIPT = ""
    NPROC = 1
    BIN_PATH = ""
    BIN = ""
    INPUT_DIR = ${INPUT_DIR_SIM}
    INPUT_FILES = inhcd
    OUTPUT_FILES = ""
    RESTART_FILES = ""
    ADD = 0
#   PS_BACKEND = INSTATE

[toric]
    CLASS = rf
    SUB_CLASS = ic
    NAME = toric
    MODULE = fastran.external.rf_ic_toric_abr_mcmd
    SCRIPT = ""
    NPROC = 24
    BIN_PATH = ${TORIC_BIN_DIR}
    TORIC_BIN = ${TORIC_BIN_DIR}/${TORIC_BIN_NAME}
    GEQXPL_BIN = ${GEQXPL_BIN_DIR}/${GEQXPL_BIN_NAME}
    ZERO_IC_POWER_BIN = ${TORIC_BIN_DIR}/zero_RF_IC_power
    
    INPUT_DIR = ${INPUT_DIR_SIM}
    INPUT_FILES = machine.inp equigs_gen.ind torica.inp
    # POWER_IC = 40
    OUTPUT_FILES = torica.inp machine.inp log.toric toric.nc profstat.dat equigs.data equidt.data toric_cfg.nc
    STATE_FILES = ${CURRENT_STATE} ${CURRENT_EQDSK}
    RESTART_FILES = ${INPUT_FILES} ${STATE_FILES}
    POWER_IC = 2.000000000000000e+01

[constraint_current0]
    CLASS = fastran
    SUB_CLASS = pre
    NAME = constraint_current
    MODULE = fastran.constraint.constraint_current
    SCRIPT = ""
    NPROC = 1
    BIN_PATH = ""
    BIN = ""
    INPUT_DIR = ${INPUT_DIR_SIM}
    INPUT_FILES = ""
    OUTPUT_FILES = ""
    RESTART_FILES = ""
    
    METHOD = broadJ
    RHO_J = 0.65
    JAXIS = 0.6
    RHO_JBDRY = 0.85

[constraint_current]
    CLASS = fastran
    SUB_CLASS = pre
    NAME = constraint_current
    MODULE = fastran.constraint.constraint_current
    SCRIPT = ""
    NPROC = 1
    BIN_PATH = ""
    BIN = ""
    INPUT_DIR = ${INPUT_DIR_SIM}
    INPUT_FILES = ""
    OUTPUT_FILES = ""
    RESTART_FILES = ""
    
    METHOD = broadJ
    RHO_J = 0.65
    JAXIS = 0.6
    RHO_JBDRY = 0.85

[modeleq_constraint]
    CLASS = fastran
    SUB_CLASS = ""
    NAME = modeleq_constraint
    MODULE = fastran.driver.modeleq_constraint
    SCRIPT = ""
    NPROC = 1
    BIN_PATH = ""
    BIN = ""
    INPUT_DIR = $INPUT_DIR_SIM
    INFASTRAN = ""
    INPUT_FILES = ""
    OUTPUT_FILES = ""
    RESTART_FILES = ""
    
    PS_UPDATE = enabled

[monitor]
    CLASS = monitor
    SUB_CLASS = ""
    NAME = monitor
    MODULE = fastran.monitor.monitor
    SCRIPT = ""
    NPROC = 1
    BIN_PATH = ""
    BIN = ""
    INPUT_DIR = ""
    INPUT_FILES = ""
    OUTPUT_FILES = ""
    RESTART_FILES = ""

# =============================================================================
# ITERATION LOOP SECTION
# =============================================================================

[ITERATION_LOOP]
    MODE = REGULAR
    NSTEP_PREPROCESS = 5
    NSTEP = 10
